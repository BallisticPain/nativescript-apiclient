"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var ApiClient = require("nativescript-apiclient");
var observable_1 = require("data/observable");
var TypeUtils = require("utils/types");
function createViewModel(page) {
    var targetCurrencies = page.getViewById("targetCurrencies");
    console.log("targetCurrencies: " + targetCurrencies);
    var amount = page.getViewById("amount");
    var viewModel = new observable_1.Observable();
    viewModel.set("currencies", ["USD", "AUD", "BGN", "BRL", "CAD", "CHF", "CNY", "CZK", "DKK", "GBP", "HKD", "HRK", "HUF", "IDR", "ILS", "INR", "JPY", "KRW", "MXN", "MYR", "NOK", "NZD", "PHP", "PLN", "RON", "RUB", "SEK", "SGD", "THB", "TRY", "ZAR"]);
    viewModel.set("sourceAmount", 1.0);
    viewModel.set("targetAmount", undefined);
    targetCurrencies.selectedIndex = 0;
    viewModel.onCalculate = function () {
        try {
            var baseCurrency = "EUR";
            var targetCurrency = targetCurrencies.items[targetCurrencies.selectedIndex];
            var a = parseFloat(viewModel.get("sourceAmount"));
            if (isNaN(a) || a <= 0) {
                a = 1.0;
            }
            console.log("Base currency: " + baseCurrency);
            console.log("Target currency: " + targetCurrency);
            var client = ApiClient.newClient({
                baseUrl: "http://api.fixer.io",
                route: "{date}",
            });
            client.addLogger(function (msg) {
                console.log("[" + ApiClient.LogSource[msg.source] + "]: " + msg.message);
            });
            client.ok(function (ctx) {
                var result = ctx.getJSON();
                ctx.dbg("OK: base: " + result.base);
                ctx.dbg("OK: date: " + result.date);
                var ta;
                if (!TypeUtils.isNullOrUndefined(result.rates[targetCurrency])) {
                    ta = result.rates[targetCurrency];
                }
                viewModel.set("targetAmount", ta * a);
                ctx.dbg("OK: target amount: " + viewModel.get("targetAmount"));
            }).complete(function (ctx) {
                ctx.dbg("Completed call of: " + ctx.request.url);
            });
            client.get({
                params: {
                    base: baseCurrency,
                    symbols: targetCurrency
                },
                routeParams: {
                    date: "latest"
                }
            });
        }
        catch (e) {
            console.error("[ERROR] ViewModel >> onCalculate(): " + e);
        }
    };
    return viewModel;
}
exports.createViewModel = createViewModel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi12aWV3LW1vZGVsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibWFpbi12aWV3LW1vZGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsa0RBQXFEO0FBR3JELDhDQUE2QztBQUk3Qyx1Q0FBMEM7QUEwQzFDLHlCQUFnQyxJQUFVO0lBQ3RDLElBQUksZ0JBQWdCLEdBQWUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0lBRXhFLE9BQU8sQ0FBQyxHQUFHLENBQUMsb0JBQW9CLEdBQUcsZ0JBQWdCLENBQUMsQ0FBQztJQUVyRCxJQUFJLE1BQU0sR0FBYSxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBRWxELElBQUksU0FBUyxHQUFRLElBQUksdUJBQVUsRUFBRSxDQUFDO0lBQ3RDLFNBQVMsQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUN2UCxTQUFTLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNuQyxTQUFTLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxTQUFTLENBQUMsQ0FBQztJQUV6QyxnQkFBZ0IsQ0FBQyxhQUFhLEdBQUcsQ0FBQyxDQUFDO0lBRW5DLFNBQVMsQ0FBQyxXQUFXLEdBQUc7UUFDcEIsSUFBSSxDQUFDO1lBQ0QsSUFBSSxZQUFZLEdBQUcsS0FBSyxDQUFDO1lBQ3pCLElBQUksY0FBYyxHQUFHLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUU1RSxJQUFJLENBQUMsR0FBRyxVQUFVLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDO1lBQ2xELEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDckIsQ0FBQyxHQUFHLEdBQUcsQ0FBQztZQUNaLENBQUM7WUFFRCxPQUFPLENBQUMsR0FBRyxDQUFDLGlCQUFpQixHQUFHLFlBQVksQ0FBQyxDQUFDO1lBQzlDLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLEdBQUcsY0FBYyxDQUFDLENBQUM7WUFFbEQsSUFBSSxNQUFNLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQztnQkFDN0IsT0FBTyxFQUFFLHFCQUFxQjtnQkFDOUIsS0FBSyxFQUFFLFFBQVE7YUFDbEIsQ0FBQyxDQUFDO1lBRUgsTUFBTSxDQUFDLFNBQVMsQ0FBQyxVQUFDLEdBQUc7Z0JBQ2pCLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLFNBQVMsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEtBQUssR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDN0UsQ0FBQyxDQUFDLENBQUM7WUFFSCxNQUFNLENBQUMsRUFBRSxDQUFDLFVBQUMsR0FBRztnQkFDVixJQUFJLE1BQU0sR0FBRyxHQUFHLENBQUMsT0FBTyxFQUFnQixDQUFDO2dCQUV6QyxHQUFHLENBQUMsR0FBRyxDQUFDLFlBQVksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3BDLEdBQUcsQ0FBQyxHQUFHLENBQUMsWUFBWSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFFcEMsSUFBSSxFQUFFLENBQUM7Z0JBQ1AsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDN0QsRUFBRSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUM7Z0JBQ3RDLENBQUM7Z0JBRUQsU0FBUyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUV0QyxHQUFHLENBQUMsR0FBRyxDQUFDLHFCQUFxQixHQUFHLFNBQVMsQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQztZQUNuRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsVUFBQyxHQUFHO2dCQUNaLEdBQUcsQ0FBQyxHQUFHLENBQUMscUJBQXFCLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNyRCxDQUFDLENBQUMsQ0FBQztZQUVILE1BQU0sQ0FBQyxHQUFHLENBQUM7Z0JBQ1AsTUFBTSxFQUFFO29CQUNKLElBQUksRUFBRSxZQUFZO29CQUNsQixPQUFPLEVBQUUsY0FBYztpQkFDMUI7Z0JBQ0QsV0FBVyxFQUFFO29CQUNULElBQUksRUFBRSxRQUFRO2lCQUNqQjthQUNKLENBQUMsQ0FBQztRQUNQLENBQUM7UUFDRCxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ1AsT0FBTyxDQUFDLEtBQUssQ0FBQyxzQ0FBc0MsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUM5RCxDQUFDO0lBQ0wsQ0FBQyxDQUFDO0lBRUYsTUFBTSxDQUFDLFNBQVMsQ0FBQztBQUNyQixDQUFDO0FBdEVELDBDQXNFQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBBcGlDbGllbnQgPSByZXF1aXJlKFwibmF0aXZlc2NyaXB0LWFwaWNsaWVudFwiKTtcbmltcG9ydCBGcmFtZSA9IHJlcXVpcmUoXCJ1aS9mcmFtZVwiKTtcbmltcG9ydCB7IExpc3RQaWNrZXIgfSBmcm9tIFwidWkvbGlzdC1waWNrZXJcIjtcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tIFwiZGF0YS9vYnNlcnZhYmxlXCI7XG5pbXBvcnQgeyBPYnNlcnZhYmxlQXJyYXkgfSBmcm9tIFwiZGF0YS9vYnNlcnZhYmxlLWFycmF5XCI7XG5pbXBvcnQgeyBQYWdlIH0gZnJvbSBcInVpL3BhZ2VcIjtcbmltcG9ydCB7IFRleHRWaWV3IH0gZnJvbSBcInVpL3RleHQtdmlld1wiO1xuaW1wb3J0IFR5cGVVdGlscyA9IHJlcXVpcmUoXCJ1dGlscy90eXBlc1wiKTtcblxuaW50ZXJmYWNlIElGaXhJT1Jlc3VsdCB7XG4gICAgYmFzZTogc3RyaW5nO1xuICAgIGRhdGU6IHN0cmluZztcbiAgICByYXRlczogSUZpeElPRXhjaGFuZ2VSYXRlcztcbn1cblxuaW50ZXJmYWNlIElGaXhJT0V4Y2hhbmdlUmF0ZXMge1xuICAgIEFVRD86IG51bWJlcjtcbiAgICBCR04/OiBudW1iZXI7XG4gICAgQlJMPzogbnVtYmVyO1xuICAgIENBRD86IG51bWJlcjtcbiAgICBDSEY/OiBudW1iZXI7XG4gICAgQ05ZPzogbnVtYmVyO1xuICAgIENaSz86IG51bWJlcjtcbiAgICBES0s/OiBudW1iZXI7XG4gICAgR0JQPzogbnVtYmVyO1xuICAgIEhLRD86IG51bWJlcjtcbiAgICBIUks/OiBudW1iZXI7XG4gICAgSFVGPzogbnVtYmVyO1xuICAgIElEUj86IG51bWJlcjtcbiAgICBJTFM/OiBudW1iZXI7XG4gICAgSU5SPzogbnVtYmVyO1xuICAgIEpQWT86IG51bWJlcjtcbiAgICBLUlc/OiBudW1iZXI7XG4gICAgTVhOPzogbnVtYmVyO1xuICAgIE1ZUj86IG51bWJlcjtcbiAgICBOT0s/OiBudW1iZXI7XG4gICAgTlpEPzogbnVtYmVyO1xuICAgIFBIUD86IG51bWJlcjtcbiAgICBQTE4/OiBudW1iZXI7XG4gICAgUk9OPzogbnVtYmVyO1xuICAgIFJVQj86IG51bWJlcjtcbiAgICBTRUs/OiBudW1iZXI7XG4gICAgU0dEPzogbnVtYmVyO1xuICAgIFRIQj86IG51bWJlcjtcbiAgICBUUlk/OiBudW1iZXI7XG4gICAgVVNEPzogbnVtYmVyO1xuICAgIFpBUj86IG51bWJlcjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVZpZXdNb2RlbChwYWdlOiBQYWdlKSB7XG4gICAgdmFyIHRhcmdldEN1cnJlbmNpZXMgPSA8TGlzdFBpY2tlcj5wYWdlLmdldFZpZXdCeUlkKFwidGFyZ2V0Q3VycmVuY2llc1wiKTtcblxuICAgIGNvbnNvbGUubG9nKFwidGFyZ2V0Q3VycmVuY2llczogXCIgKyB0YXJnZXRDdXJyZW5jaWVzKTtcblxuICAgIHZhciBhbW91bnQgPSA8VGV4dFZpZXc+cGFnZS5nZXRWaWV3QnlJZChcImFtb3VudFwiKTtcblxuICAgIHZhciB2aWV3TW9kZWw6IGFueSA9IG5ldyBPYnNlcnZhYmxlKCk7XG4gICAgdmlld01vZGVsLnNldChcImN1cnJlbmNpZXNcIiwgW1wiVVNEXCIsIFwiQVVEXCIsIFwiQkdOXCIsIFwiQlJMXCIsIFwiQ0FEXCIsIFwiQ0hGXCIsIFwiQ05ZXCIsIFwiQ1pLXCIsIFwiREtLXCIsIFwiR0JQXCIsIFwiSEtEXCIsIFwiSFJLXCIsIFwiSFVGXCIsIFwiSURSXCIsIFwiSUxTXCIsIFwiSU5SXCIsIFwiSlBZXCIsIFwiS1JXXCIsIFwiTVhOXCIsIFwiTVlSXCIsIFwiTk9LXCIsIFwiTlpEXCIsIFwiUEhQXCIsIFwiUExOXCIsIFwiUk9OXCIsIFwiUlVCXCIsIFwiU0VLXCIsIFwiU0dEXCIsIFwiVEhCXCIsIFwiVFJZXCIsIFwiWkFSXCJdKTtcbiAgICB2aWV3TW9kZWwuc2V0KFwic291cmNlQW1vdW50XCIsIDEuMCk7XG4gICAgdmlld01vZGVsLnNldChcInRhcmdldEFtb3VudFwiLCB1bmRlZmluZWQpO1xuXG4gICAgdGFyZ2V0Q3VycmVuY2llcy5zZWxlY3RlZEluZGV4ID0gMDtcblxuICAgIHZpZXdNb2RlbC5vbkNhbGN1bGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHZhciBiYXNlQ3VycmVuY3kgPSBcIkVVUlwiO1xuICAgICAgICAgICAgdmFyIHRhcmdldEN1cnJlbmN5ID0gdGFyZ2V0Q3VycmVuY2llcy5pdGVtc1t0YXJnZXRDdXJyZW5jaWVzLnNlbGVjdGVkSW5kZXhdO1xuXG4gICAgICAgICAgICB2YXIgYSA9IHBhcnNlRmxvYXQodmlld01vZGVsLmdldChcInNvdXJjZUFtb3VudFwiKSk7XG4gICAgICAgICAgICBpZiAoaXNOYU4oYSkgfHwgYSA8PSAwKSB7XG4gICAgICAgICAgICAgICAgYSA9IDEuMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJCYXNlIGN1cnJlbmN5OiBcIiArIGJhc2VDdXJyZW5jeSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRhcmdldCBjdXJyZW5jeTogXCIgKyB0YXJnZXRDdXJyZW5jeSk7XG5cbiAgICAgICAgICAgIHZhciBjbGllbnQgPSBBcGlDbGllbnQubmV3Q2xpZW50KHtcbiAgICAgICAgICAgICAgICBiYXNlVXJsOiBcImh0dHA6Ly9hcGkuZml4ZXIuaW9cIixcbiAgICAgICAgICAgICAgICByb3V0ZTogXCJ7ZGF0ZX1cIixcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjbGllbnQuYWRkTG9nZ2VyKChtc2cpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIltcIiArIEFwaUNsaWVudC5Mb2dTb3VyY2VbbXNnLnNvdXJjZV0gKyBcIl06IFwiICsgbXNnLm1lc3NhZ2UpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNsaWVudC5vaygoY3R4KSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGN0eC5nZXRKU09OPElGaXhJT1Jlc3VsdD4oKTtcblxuICAgICAgICAgICAgICAgIGN0eC5kYmcoXCJPSzogYmFzZTogXCIgKyByZXN1bHQuYmFzZSk7XG4gICAgICAgICAgICAgICAgY3R4LmRiZyhcIk9LOiBkYXRlOiBcIiArIHJlc3VsdC5kYXRlKTtcblxuICAgICAgICAgICAgICAgIHZhciB0YTtcbiAgICAgICAgICAgICAgICBpZiAoIVR5cGVVdGlscy5pc051bGxPclVuZGVmaW5lZChyZXN1bHQucmF0ZXNbdGFyZ2V0Q3VycmVuY3ldKSkge1xuICAgICAgICAgICAgICAgICAgICB0YSA9IHJlc3VsdC5yYXRlc1t0YXJnZXRDdXJyZW5jeV07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmlld01vZGVsLnNldChcInRhcmdldEFtb3VudFwiLCB0YSAqIGEpO1xuXG4gICAgICAgICAgICAgICAgY3R4LmRiZyhcIk9LOiB0YXJnZXQgYW1vdW50OiBcIiArIHZpZXdNb2RlbC5nZXQoXCJ0YXJnZXRBbW91bnRcIikpO1xuICAgICAgICAgICAgfSkuY29tcGxldGUoKGN0eCkgPT4ge1xuICAgICAgICAgICAgICAgIGN0eC5kYmcoXCJDb21wbGV0ZWQgY2FsbCBvZjogXCIgKyBjdHgucmVxdWVzdC51cmwpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNsaWVudC5nZXQoe1xuICAgICAgICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgICAgICAgICBiYXNlOiBiYXNlQ3VycmVuY3ksXG4gICAgICAgICAgICAgICAgICAgIHN5bWJvbHM6IHRhcmdldEN1cnJlbmN5XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICByb3V0ZVBhcmFtczoge1xuICAgICAgICAgICAgICAgICAgICBkYXRlOiBcImxhdGVzdFwiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJbRVJST1JdIFZpZXdNb2RlbCA+PiBvbkNhbGN1bGF0ZSgpOiBcIiArIGUpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHJldHVybiB2aWV3TW9kZWw7XG59XG4iXX0=